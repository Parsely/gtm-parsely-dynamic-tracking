___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Parse.ly Dynamic Tracking",
  "categories": ["ANALYTICS"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Manually fires a Parse.ly pageview. Note that the Parse.ly Tracker tag automatically sends a pageview when loaded by default.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "url",
    "displayName": "Page URL",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "enablingConditions": [
      {
        "paramName": "defaultUrlReferrer",
        "paramValue": false,
        "type": "EQUALS"
      }
    ],
    "help": "Enter the URL of the page being viewed.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "urlref",
    "displayName": "Referring URL",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "enablingConditions": [
      {
        "paramName": "defaultUrlReferrer",
        "paramValue": false,
        "type": "EQUALS"
      }
    ],
    "help": "Enter the referring URL for the page being viewed.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "defaultUrlReferrer",
    "checkboxText": "Use browser URL and referrer values",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "help": "Select this option to use the browser\u0027s default values for the page URL and referring URL. If using dynamic tracking in an SPA for infinite scroll, these values are typically incorrect and should be populated with variables containing the correct values."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const callInWindow = require('callInWindow');

log('data =', data);

if (data.defaultUrlReferrer) {
  
  // fire a pageview using the browser's current `location.href` and `location.referrer`
  callInWindow('PARSELY.beacon.trackPageView', {
    js: 1
  });
  log('Parse.ly pageview sent with browser values');
  data.gtmOnSuccess();
  
} else {
  
  // fire a pageview
  callInWindow('PARSELY.beacon.trackPageView', {
    url: data.url,
    urlref: data.urlref,
    js: 1
  });
  log('Parse.ly pageview sent with custom values');
  data.gtmOnSuccess();
  
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "PARSELY.beacon.trackPageView"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 02/02/2023, 16:08:26


